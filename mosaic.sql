-- phpMyAdmin SQL Dump
-- version 5.0.4
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Nov 20, 2021 at 10:17 AM
-- Server version: 10.4.17-MariaDB
-- PHP Version: 8.0.0

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `mosaic`
--
CREATE DATABASE IF NOT EXISTS `mosaic` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE `mosaic`;

DELIMITER $$
--
-- Procedures
--
DROP PROCEDURE IF EXISTS `prime_cost`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `prime_cost` ()  NO SQL
    COMMENT 'Расчет себестоимости'
select stock.vendor_code, price, `count` from stock left join 
(select vendor_code, amount/quantity + (
select (select sum(amount) from spendings  where quantity is null)/sum(quantity) from spendings) as price
from spendings 
where quantity is NOT null
) as net_cost
on net_cost.vendor_code=stock.vendor_code
where order_id=1$$

DROP PROCEDURE IF EXISTS `stocks_wo_backlog`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `stocks_wo_backlog` ()  NO SQL
    COMMENT 'Запасы материалов с вычетом забронированных в оплаченные заказы'
SELECT `vendor_code`, sum(`quantity`) as `quantity` FROM `stock` GROUP by `vendor_code` ORDER by `quantity`$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `move_types`
--

DROP TABLE IF EXISTS `move_types`;
CREATE TABLE IF NOT EXISTS `move_types` (
  ` move_name` varchar(50) NOT NULL COMMENT 'Вид движения',
  `move_desc` varchar(1024) NOT NULL COMMENT 'Описание вида движения',
  PRIMARY KEY (` move_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='Виды движения';

--
-- Dumping data for table `move_types`
--

INSERT INTO `move_types` (` move_name`, `move_desc`) VALUES
('BACKLOG', 'Резерв под оплаченный заказ'),
('INCOME', 'Поступление'),
('LOST', 'Утеря');

-- --------------------------------------------------------

--
-- Table structure for table `orders`
--

DROP TABLE IF EXISTS `orders`;
CREATE TABLE IF NOT EXISTS `orders` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Уникальный идентификатор',
  `order` varchar(50) NOT NULL COMMENT 'Описание заказа',
  `create_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата создания',
  `change_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата последнего изменения',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='Сбытовые заказы';

--
-- Dumping data for table `orders`
--

INSERT INTO `orders` (`id`, `order`, `create_time`, `change_time`) VALUES
(1, '55', '2021-11-20 07:33:34', '2021-11-20 07:33:34');

-- --------------------------------------------------------

--
-- Table structure for table `spendings`
--

DROP TABLE IF EXISTS `spendings`;
CREATE TABLE IF NOT EXISTS `spendings` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Уникальный идентификатор',
  `spending` varchar(50) NOT NULL COMMENT 'Описание затрат',
  `spend_date` date NOT NULL COMMENT 'Дата затрат',
  `order_id` bigint(20) DEFAULT NULL COMMENT 'Заказ, в который относятся затраты',
  `supply_id` bigint(20) DEFAULT NULL COMMENT 'Поставка, в которую относятся затраты',
  `vendor_code` varchar(50) DEFAULT NULL COMMENT 'Код вендора для материала',
  `quantity` float DEFAULT NULL COMMENT 'Количество',
  `amount` float NOT NULL COMMENT 'Сумма',
  `create_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата создания',
  `change_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата последнего изменения',
  PRIMARY KEY (`id`),
  KEY `order_id` (`order_id`),
  KEY `vendor_code` (`vendor_code`),
  KEY `id` (`supply_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=65 DEFAULT CHARSET=utf8mb4 COMMENT='Затраты';

--
-- Dumping data for table `spendings`
--

INSERT INTO `spendings` (`id`, `spending`, `spend_date`, `order_id`, `supply_id`, `vendor_code`, `quantity`, `amount`, `create_time`, `change_time`) VALUES
(1, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A01', 2523, 690, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(2, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A02', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(3, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A03', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(4, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A04', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(5, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A06', 2523, 786, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(6, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A07', 4202, 1310, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(7, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A09', 2523, 786, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(8, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A11', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(9, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A12', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(10, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A13', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(11, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A14', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(12, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A15', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(13, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A16', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(14, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A17', 1682, 460, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(15, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A18', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(16, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A20', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(17, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A21', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(18, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A22', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(19, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A23', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(20, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A25', 840, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(21, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A26', 840, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(22, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A30', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(23, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A32', 2523, 786, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(24, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A33', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(25, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A34', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(26, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A35', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(27, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A36', 1682, 460, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(28, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A38', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(29, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A42', 1681, 524, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(30, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A43', 1682, 524, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(31, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A44', 1682, 460, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(32, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A45', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(33, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A49', 841, 345, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(34, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A52', 841, 230, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(35, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A54', 1682, 524, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(36, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A58', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(37, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A60', 1682, 524, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(38, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A62', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(39, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A63', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(40, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A67', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(41, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A73', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(42, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A77', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(43, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A82', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(44, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A85', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(45, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A86', 841, 262, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(46, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A87', 841, 278, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(47, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A90', 858, 720, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(48, 'Покупка в грандмозаика', '2021-11-15', NULL, 1, 'A92', 841, 720, '2021-11-20 07:32:25', '2021-11-20 07:32:25'),
(64, 'Покупка в грандмозаика (доставка)', '2021-11-15', NULL, 1, NULL, NULL, 1340, '2021-11-20 07:32:25', '2021-11-20 07:32:25');

-- --------------------------------------------------------

--
-- Table structure for table `stock`
--

DROP TABLE IF EXISTS `stock`;
CREATE TABLE IF NOT EXISTS `stock` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Уникальный идентификатор',
  `vendor_code` varchar(50) NOT NULL COMMENT 'Код вендора для материала',
  `move` varchar(50) NOT NULL COMMENT 'Вид движения',
  `description` varchar(1024) NOT NULL COMMENT 'Описание',
  `move_date` date NOT NULL COMMENT 'Дата движения',
  `quantity` float NOT NULL COMMENT 'Количество',
  `order_id` bigint(20) DEFAULT NULL COMMENT 'Заказ, с которым связано движение',
  `supply_id` bigint(20) DEFAULT NULL COMMENT 'Поставка, с которой связано движение',
  `create_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата создания записи',
  `change_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата последнего изменения записи',
  PRIMARY KEY (`id`),
  KEY `move` (`move`),
  KEY `vendor_code` (`vendor_code`),
  KEY `order_id` (`order_id`),
  KEY `supply_id` (`supply_id`)
) ENGINE=InnoDB AUTO_INCREMENT=105 DEFAULT CHARSET=utf8mb4 COMMENT='Движение материалов';

--
-- Dumping data for table `stock`
--

INSERT INTO `stock` (`id`, `vendor_code`, `move`, `description`, `move_date`, `quantity`, `order_id`, `supply_id`, `create_time`, `change_time`) VALUES
(1, 'A07', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 4205, NULL, 1, '2021-11-17 17:56:55', '2021-11-20 08:36:07'),
(3, 'A32', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 2523, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(4, 'A09', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 2523, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(5, 'A06', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 2523, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(6, 'A01', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 2523, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(7, 'A42', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(8, 'A44', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(9, 'A36', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(10, 'A60', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(11, 'A43', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(12, 'A54', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(13, 'A17', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 1682, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(14, 'A86', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(15, 'A35', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(16, 'A49', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(17, 'A11', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(18, 'A14', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(19, 'A85', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(20, 'A52', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(21, 'A13', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(22, 'A34', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(23, 'A12', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(24, 'A21', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(25, 'A62', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(26, 'A04', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(27, 'A92', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(28, 'A33', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(29, 'A63', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(30, 'A03', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(31, 'A67', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(32, 'A73', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(33, 'A87', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(34, 'A30', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(35, 'A90', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(36, 'A58', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(37, 'A26', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(38, 'A22', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(39, 'A02', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(40, 'A38', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(41, 'A77', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(42, 'A15', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(43, 'A25', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(44, 'A82', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(45, 'A23', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:55', '2021-11-20 08:36:07'),
(46, 'A18', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:56', '2021-11-20 08:36:07'),
(47, 'A45', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:56', '2021-11-20 08:36:07'),
(48, 'A16', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:56', '2021-11-20 08:36:07'),
(49, 'A20', 'INCOME', 'Покупка в Grand Мозаике', '2021-11-15', 841, NULL, 1, '2021-11-17 18:20:56', '2021-11-20 08:36:07'),
(50, 'A07', 'LOST', 'Недостача', '2021-11-15', -3, NULL, 1, '2021-11-17 18:31:22', '2021-11-20 08:36:07'),
(51, 'A42', 'LOST', 'Недостача', '2021-11-15', -1, NULL, 1, '2021-11-17 18:31:22', '2021-11-20 08:36:07'),
(52, 'A26', 'LOST', 'Недостача', '2021-11-15', -1, NULL, 1, '2021-11-17 18:32:31', '2021-11-20 08:36:07'),
(53, 'A25', 'LOST', 'Недостача', '2021-11-15', -1, NULL, 1, '2021-11-17 18:32:31', '2021-11-20 08:36:07'),
(54, 'A90', 'LOST', 'Избыток в поставке', '2021-11-15', 17, NULL, 1, '2021-11-17 18:33:28', '2021-11-20 08:36:07'),
(55, 'A07', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -3889, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(56, 'A32', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -2286, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(57, 'A09', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -2279, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(58, 'A06', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1889, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(59, 'A01', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1710, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(60, 'A42', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1631, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(61, 'A44', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1573, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(62, 'A36', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1095, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(63, 'A60', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1089, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(64, 'A43', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1063, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(65, 'A54', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -884, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(66, 'A17', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -848, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(67, 'A86', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -835, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(68, 'A35', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -820, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(69, 'A49', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -720, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(70, 'A11', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -651, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(71, 'A14', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -538, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(72, 'A85', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -536, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(73, 'A52', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -450, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(74, 'A13', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -438, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(75, 'A34', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -407, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(76, 'A12', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -405, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(77, 'A21', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -376, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(78, 'A62', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -305, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(79, 'A04', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -303, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(80, 'A92', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -287, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(81, 'A33', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -269, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(82, 'A63', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -261, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(83, 'A03', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -222, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(84, 'A67', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -204, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(85, 'A73', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -185, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(86, 'A87', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -177, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(87, 'A30', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -163, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(88, 'A90', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -160, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(89, 'A58', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -154, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(90, 'A26', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -150, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(91, 'A22', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -128, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(92, 'A02', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -123, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(93, 'A38', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -117, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(94, 'A77', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -90, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(95, 'A15', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -87, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(96, 'A25', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -82, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(97, 'A82', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -59, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(98, 'A23', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -36, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(99, 'A18', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -11, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(100, 'A45', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -8, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(101, 'A16', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -4, 1, NULL, '2021-11-17 18:45:55', '2021-11-19 08:52:05'),
(103, 'A20', 'BACKLOG', 'Под заказ рыббы', '2021-11-16', -1, 1, NULL, '2021-11-17 18:45:56', '2021-11-19 08:52:05'),
(104, 'A87', 'BACKLOG', 'Под заказ рыббы (вместо A96)', '2021-11-16', -2, 1, NULL, '2021-11-17 18:55:43', '2021-11-19 08:52:05');

-- --------------------------------------------------------

--
-- Table structure for table `supplies`
--

DROP TABLE IF EXISTS `supplies`;
CREATE TABLE IF NOT EXISTS `supplies` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Уникальный идентификатор',
  `supply` varchar(50) NOT NULL COMMENT 'Описание поставки',
  `supply_date` date NOT NULL COMMENT 'Дата поставки',
  `create_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата создания записи',
  `change_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT 'Дата последнего изменения',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='Поставки';

--
-- Dumping data for table `supplies`
--

INSERT INTO `supplies` (`id`, `supply`, `supply_date`, `create_time`, `change_time`) VALUES
(1, 'Под рыббы', '2021-11-15', '2021-11-20 07:30:56', '2021-11-20 07:30:56');

--
-- Constraints for dumped tables
--

--
-- Constraints for table `spendings`
--
ALTER TABLE `spendings`
  ADD CONSTRAINT `spendings_ibfk_1` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`),
  ADD CONSTRAINT `spendings_ibfk_2` FOREIGN KEY (`supply_id`) REFERENCES `supplies` (`id`);

--
-- Constraints for table `stock`
--
ALTER TABLE `stock`
  ADD CONSTRAINT `stock_ibfk_1` FOREIGN KEY (`move`) REFERENCES `move_types` (` move_name`),
  ADD CONSTRAINT `stock_ibfk_2` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`),
  ADD CONSTRAINT `stock_ibfk_3` FOREIGN KEY (`supply_id`) REFERENCES `supplies` (`id`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
